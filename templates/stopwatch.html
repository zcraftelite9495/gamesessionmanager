<!-- templates/stopwatch.html -->
{% extends "base.html" %}

{% block title %}Stopwatch{% endblock %}

{% block content %}
<div class="container">
    <h1>Log using Stopwatch Mode (BETA)</h1>
    <form action="/submit_stopwatch" method="POST">
        <div>
            <label for="game_name">Game Name:</label>
            <input type="text" id="game_name" name="game_name" required>
        </div>
        <div>
            <label for="game_platform">Game Platform:</label>
            <input type="text" id="game_platform" name="game_platform" required>
        </div>
        <div>
            <label for="start_time">Start Time:</label>
            <input type="text" id="start_time" name="start_time" readonly required>
        </div>
        <div>
            <label for="end_time">End Time:</label>
            <input type="text" id="end_time" name="end_time" readonly required>
        </div>
        <div class="stopwatch">
            <div id="stopwatch_display" class="stopwatch_text">00:00:00</div>
            <div class="stopwatch_button_group">
                <button class="stopwatch_button start" type="button" id="start_button">Start</button>
                <button class="stopwatch_button stop" type="button" id="stop_button" disabled>Stop</button>
                <button class="stopwatch_button cancel" type="button" id="reset_button" disabled>Reset</button>
            </div>
        </div>
        <button class="submit-button" type="submit" id="submit_button" disabled>Submit</button>
    </form>
</div>

<script>
    let startTime;
    let interval;

    document.getElementById('start_button').onclick = function() {
        startTime = Date.now();
        interval = setInterval(updateStopwatch, 1000);
        document.getElementById('start_time').value = new Date(startTime).toLocaleTimeString();
        document.getElementById('start_button').disabled = true;
        document.getElementById('stop_button').disabled = false;
        document.getElementById('reset_button').disabled = false;
        document.getElementById('submit_button').disabled = false;
    };

    document.getElementById('stop_button').onclick = function() {
        clearInterval(interval);
        const endTime = Date.now();
        document.getElementById('end_time').value = new Date(endTime).toLocaleTimeString();
        document.getElementById('stop_button').disabled = true;
        document.getElementById('start_button').disabled = false;

        // Automatically submit the form
        document.querySelector('form').submit();
    };

    document.getElementById('reset_button').onclick = function() {
        // Reset the stopwatch and input fields
        clearInterval(interval);
        document.getElementById('stopwatch_display').innerText = '00:00:00';
        document.getElementById('start_time').value = '';
        document.getElementById('end_time').value = '';
        document.getElementById('start_button').disabled = false;
        document.getElementById('stop_button').disabled = true;
        document.getElementById('reset_button').disabled = true;
        document.getElementById('submit_button').disabled = true;
    };

    function updateStopwatch() {
        const elapsedTime = Date.now() - startTime;
        const seconds = Math.floor((elapsedTime / 1000) % 60);
        const minutes = Math.floor((elapsedTime / 60000) % 60);
        const hours = Math.floor((elapsedTime / 3600000) % 24);
        document.getElementById('stopwatch_display').innerText = 
            String(hours).padStart(2, '0') + ':' + 
            String(minutes).padStart(2, '0') + ':' + 
            String(seconds).padStart(2, '0');
    }
</script>
{% endblock %}
